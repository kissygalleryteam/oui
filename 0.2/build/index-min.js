/*! oui - v0.2 - 2013-10-11 4:51:23 PM
* Copyright (c) 2013 goto100; Licensed  */
KISSY.add("gallery/oui/0.2/handler",function(a,b){var c=b.Class,d=new c({handleNew:function(){},handleMeta:function(){},handleMember:function(){},handleInitialize:function(){},handleInitialize2:function(){}});return d},{requires:["gallery/oop/0.1/index"]}),KISSY.add("gallery/oui/0.2/schemas/options",function(a,b,c){function d(a,b){return b in a.__properties__?a.__properties__[b]:a[b]}function e(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]})}function f(a,c){var d=b.property(function(){return this.getOption(d.__name__)||d.defaultValue},function(a){this.setOption(d.__name__,a)});return d.uitype=arguments.callee,d.defaultValue=a,e(d,c||{}),d}var g=new b.Class(c,{handleNew:function(a,b,c,d){d.getOption=this.getOption,d.setOption=this.setOption},setOption:function(a,b){var c=this,e=d(c,a);e&&(b&&"object"==typeof b?Object.keys(b).forEach(function(a){var c=b[a];e[a]=c}):c["__"+a]=b)},getOption:function(a){var b,c=this,e=d(c,a),f=e.defaultValue.constructor;return c["__"+a]?b=f(c["__"+a]):e.attribute&&(b=f(c.node.attr(a))),b}});return{option:f,OptionsHandler:g}},{requires:["gallery/oop/0.1/index","../handler"]}),KISSY.add("gallery/oui/0.2/schemas/accessors",function(a,b){function c(a,c){c=c||{};var d=b.property(function(){var a=d.method||"all",b=this.node[a](d.selector);return"one"==a&&b&&b[0].component?b[0].component:b});return d.uitype=arguments.callee,d.selector=a,Object.keys(c).forEach(function(a){d[a]=c[a]}),d}function d(a,b){return b=b||{},b.method="one",c(a,b)}function e(a,b){return b=b||{},b.method="parent",c(a,b)}return b.Class,{define1:d,define:c,parent:e}},{requires:["gallery/oop/0.1/index","../handler"]}),KISSY.add("gallery/oui/0.2/schemas/promise",function(a,b){function c(a){return function(){var c=new b.Defer,d=Array.prototype.slice.call(arguments,0);return d.push(c.resolve.bind(c)),a.apply(this,d),c.promise}}return{promise:c}},{requires:["promise"]}),KISSY.add("gallery/oui/0.2/schemas/time",function(a,b){function c(a){return function(b){var c,e,f,g,h,i,j=d(function(){h=g=!1},a);return function(){c=this,e=arguments;var d=function(){f=null,h&&(i=b.apply(c,e)),j()};return f||(f=setTimeout(d,a)),g?h=!0:(g=!0,i=b.apply(c,e)),j(),i}}}function d(a,b){return function(c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,b||(e=c.apply(f,g))},i=b&&!d;return clearTimeout(d),d=setTimeout(h,a),i&&(e=c.apply(f,g)),e}}}function e(b){return function(c){var d=function(){d.timer=setInterval(a.bind(c,this),d.time)};return d.time=b,d.stop=function(){clearInterval(d.timer)},d}}function g(a,b){return b||(a=0,b=a),function(c){var d=function(){if(!d.timer){var a=this,b=arguments,e=Math.floor(Math.random()*(d.time[1]-d.time[0])+d.time[0]);d.timer=setTimeout(function(){c.apply(a,b),d.stop(),d.apply(a,b)},e)}};return d.time=[a,b],d.stop=function(){clearTimeout(d.timer),d.timer=null},d}}var h=b.Class,i=new h({__actived:null,__activeMode:0,__activations:{},enableActiveMode:!0,active:function(a,b){function c(){d.active(),d.activeTimer=null,e.enableActiveMode&&e.__activeMode++}var d,e=this;b?"object"==typeof b?(d=b.activation||{},b.activation=d):(d=e.__activations[b]||{},e.__activations[b]=d):d={},d.active=a,e.__actived=d,d.deactiveTimer?e.stopDeactive():e.__activeMode?c():d.activeTimer=setTimeout(c,e.activeWait)},deactive:function(a){function b(){d.deactive(),d.deactiveTimer=null,c.enableActiveMode&&c.__activeMode--}var c=this,d=c.__actived;d.deactive=a,d.activeTimer?c.stopActive():c.deactiveWait?d.deactiveTimer=setTimeout(b,c.deactiveWait):b()},hold:function(){var a=this;a.stopDeactive()},release:function(){var a=this,b=a.__actived;a.deactive(b.deactive)},stopActive:function(){var a=this,b=a.__actived;clearTimeout(b.activeTimer),b.activeTimer=null},stopDeactive:function(){var a=this,b=a.__actived;clearTimeout(b.deactiveTimer),b.deactiveTimer=null},activate:function(a){var b=this;return b.activeWait=a,function(a){return function(c){var d=this,e=arguments;b.active(function(){a.apply(d,e)},c)}}},deactivate:function(a){function b(){var a=this,b=arguments;d.deactive(function(){c.apply(a,b)})}var c,d=this;return"function"==typeof a?(c=a,b):(d.deactiveWait=a,function(){return c=f,b})}});return{throttle:c,debounce:d,interval:e,randomInterval:g,DelayActivator:i}},{requires:["gallery/oop/0.1/index"]}),KISSY.add("gallery/oui/0.2/schemas/data",function(a,b,c,d,e,f,g){function h(a){return a.charAt(0).toUpperCase()+a.slice(1)}function i(a){a=a||{};var c=b.property(function(){return this["_"+c.__name__]},function(a){this["_"+c.__name__]=a});return c.uitype=arguments.callee,Object.keys(a).forEach(function(b){c[b]=a[b]}),c}var j=b.Class,k=new j(c,{handleMember:function(a,c,j){if(j&&j.__class__==b.property&&j.uitype==i){var k="load"+h(c),l=function(a,b){var c={url:j.api,jsonp:j.jsonp,type:j.method,dataType:j.dataType,scriptCharset:j.scriptCharset,data:g.to_html(j.data,a),success:b};f(c)};j.debounce&&(l=e.debounce(j.debounce,j.immediate)(l)),j.throttle&&(l=e.throttle(j.throttle)(l)),a.__setattr__(k,d.promise(l))}}});return{data:i,DataHandler:k}},{requires:["gallery/oop/0.1/index","../handler","./promise","./time","ajax","brix/gallery/mu/index"]}),KISSY.add("gallery/oui/0.2/Handler",function(a,b){var c=b.Class,d=new c({handleNew:function(){},handleMeta:function(){},handleMember:function(){},handleInitialize:function(){},handleInitialize2:function(){}});return d},{requires:["gallery/oop/0.1/index"]}),KISSY.add("gallery/oui/0.2/schemas/template",function(a,b,c,d,e,f){var g=new b.Class(d,{getTemplate:function(b){b=b||{};var c;return b.template?c=b.template:b["template-from"]?c=a.one(b["template-from"]).html():b["template-module"]&&(c=a.require(b["template-module"])),c},getRenderPoint:function(b){return a.one(b["template-from"])},renderShadow:function(b){var c,d=this,e=d.getTemplate(b.meta);e&&(c=document.createDocumentFragment(),a.all(e).appendTo(c),placeholders=a.all(c.querySelectorAll("content")),placeholders.each(function(a){var c=a.attr("select")||"*",d=b.node.all(c);d.length||(d=a.children()),a.replaceWith(d)})),c&&(b.node.html(""),b.node.append(c))},handleNew:function(b,d,g,h){var i=this,j=function(b,c,d){var g=this.__properties__[b],h=i.getTemplate(g),j=f.to_html(h,c),k=i.getRenderPoint(g);k?e.insertBefore(a.one(j),k):this.node.append(j),d()};h.render=c.promise(j)},handleInitialize:function(a){var b=this;b.renderShadow(a)}});return{TemplateHandler:g}},{requires:["gallery/oop/0.1/index","./promise","../Handler","dom","brix/gallery/mu/index","sizzle"]}),KISSY.add("gallery/oui/0.2/schemas/events",function(a,b,c,d,e){var f=b.Class,g=new f(c,{handleNew:function(a,b,c,d){d.meta.bindEvents=[]},handleMember:function(a,b){b.match(/^on(.*)/)&&a.meta.bindEvents.push({name:RegExp.$1,method:b})},handleInitialize:function(a){a.meta.bindEvents.forEach(function(b){a.node.on(b.name,a[b.method].bind(a))})}}),h=new f(c,{handleNew:function(a,b,c,d){d.meta.subEvents=[]},handleMember:function(a,b){b.match(/^(.+)_on(.+)$/)&&a.meta.subEvents.push({sub:RegExp.$1,name:RegExp.$2,method:b})},handleInitialize:function(a){var b=a.meta,c=[].concat(a.meta.subEvents),d=[].concat(b.define||[]).concat(b.define1||[]).concat(b.parent||[]);d.forEach(function(b){var d=a.__properties__[b];d&&d.bind&&Object.keys(d.bind).forEach(function(e){var f=d.bind[e].split(/\s*,\s*/);c.push({sub:b,name:e,func:function(b){var c=this;f.forEach(function(d){var e=d.match(/^(.*?)(?:\((.*)\))?$/),f=e[1],g=e[2],h=[];g&&("$event"==g?h.push(b):"$target"==g&&h.push(b.target)),a[f].apply(c,h)})}})})}),c.forEach(function(b){var c=a.__properties__[b.sub],d=c.selector;~["blur","valuechange"].indexOf(b.name)?e.on(d,b.name,function(c){b.method?a[b.method](c):b.func&&b.func.call(a,c)},a.node):e.delegate(a.node,b.name,d,function(c){b.method?a[b.method](c):b.func&&b.func.call(a,c)})})}});return{BindEventHandler:g,SubEventHandler:h}},{requires:["gallery/oop/0.1/index","../handler","./accessors","event"]}),KISSY.add("gallery/oui/0.2/schemas/register",function(a,b,c){function d(b){Object.keys(e).forEach(function(c){var d=e[c];a.all(c,b).each(function(b){var c,e=b.nodeName(),f=d.meta.baseTag;f&&f!=e&&(c=a.one("<"+f+' is="'+e+'" />'),a.each(b[0].attributes,function(a){c.attr(a.name,a.value)}),b.children().appendTo(c),b.replaceWith(c),b=c),new d(b)})})}var e={},f=new b.Class(c,{handleInitialize2:function(a){a.meta.tag&&(e[(a.meta.namespace||"x")+"-"+a.meta.tag]=a)}});return{customTags:e,RegisterHandler:f,bootstrap:d}},{requires:["gallery/oop/0.1/index","../Handler"]}),KISSY.add("gallery/oui/0.2/schemas/factory",function(a,b,c,d,e,f){var g=b.Class,h=new g(c,{mergeMeta:function(a,b){return Object.keys(b).forEach(function(c){a.meta[c]=b[c]}),a.meta},handleMember:function(a,b,c){"__meta"==b?this.handleMeta(a,c):"__factory"==b&&this.handleFactory(a,c)},handleInitialize:function(a){var b=a.__factory;b&&Object.keys(b).forEach(function(c){if("meta"!=c){var d=b[c];a.setOption(c,d)}})},handleMeta:function(a,b){var c=this;b=c.mergeMeta(a,b)},handleFactory:function(a,b){var c=this.mergeMeta(a,b.meta);c.data&&c.data.forEach(function(b){a.__setattr__(b,d.data())}),c.define&&c.define.forEach(function(b){a.__setattr__(b,e.define())}),c.define1&&c.define1.forEach(function(b){a.__setattr__(b,e.define1())}),c.parent&&c.parent.forEach(function(b){a.__setattr__(b,e.parent())}),c.options&&c.options.forEach(function(b){a.__setattr__(b,f.option())})}});return{FactoryHandler:h}},{requires:["gallery/oop/0.1/index","../handler","./data","./accessors","./options"]}),KISSY.add("gallery/oui/0.2/schemas/keyboard",function(a,b,c){function d(a){var b;return"number"==typeof a&&(a=[a]),function(d){return b=c.promise(function(a,c){~b.keyCodes.indexOf(a.keyCode)?d.apply(this,arguments):c&&c()}),b.keyCodes=a,b}}return{keycode:d}},{requires:["gallery/oop/0.1/index","./promise"]}),KISSY.add("gallery/oui/0.2/index",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){}function o(a){p.register.bootstrap(a)}var p={options:d,accessors:e,data:f,template:g,events:h,promise:i,register:j,factory:k,time:l,keyboard:m},q=c.Class,r=new q(c.Type,{__new__:function(a,b,d,e){var f,g=e.meta||{};return e.uses?(f=[],e.uses.forEach(function(a){f.push(new a)}),e.handlers=f):f=d.handlers,e.meta=g,e.__constructed=!1,f.forEach(function(c){c.handleNew(a,b,d,e)}),c.Type.__new__(a,b,d,e)},initialize:function(a,b,c){var d=this;d.__constructed=!0,d.handlers&&(Object.keys(c).forEach(function(a){var b=c[a];d.handlers.forEach(function(c){c.handleMember(d,a,b)})}),d.handlers.forEach(function(a){a.handleInitialize2(d)}))},__setattr__:function(a,b){var d=this;c.Type.prototype.__setattr__.call(d,a,b),d.__constructed&&d.handlers&&d.handlers.forEach(function(c){c.handleMember(d,a,b)})}});n.prototype=b.Target;var s=new q({__metaclass__:r,__mixins__:[n],uses:[k.FactoryHandler,d.OptionsHandler,h.BindEventHandler,h.SubEventHandler,f.DataHandler,g.TemplateHandler,j.RegisterHandler],initialize:function(b){if(!b)throw new Error("bad argument, component must wrap a node");var c;if(b.constructor==a.Node?(c=b,b=b[0]):c=a.one(b),b.component)throw new Error("node has already wraped");this._node=b,this.node=c,this._node.component=this,this.handlers.forEach(function(a){a.handleInitialize(this)},this)}}),t={};return t.Component=s,t.option=d.option,t.define1=e.define1,t.define=e.define,t.data=f.data,t.schemas=p,t.bootstrap=o,t},{requires:["event","gallery/oop/0.1/index","./schemas/options","./schemas/accessors","./schemas/data","./schemas/template","./schemas/events","./schemas/promise","./schemas/register","./schemas/factory","./schemas/time","./schemas/keyboard"]});